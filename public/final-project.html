<!DOCTYPE html>
<html>

    <head>

        <meta charset="UTF-8">

        <title>JQuery Final</title>

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">


        <style>
            #quizzie ul {
                list-style: none;
                display: block;
                width: auto;
                margin: 2% 2%;
                padding: 2%;
                overflow: auto;
                display: none;
                /* Step Questions and Answer Options */
            }
            #quizzie ul.current {
                display: block;
            }
            #quizzie ul li {
                display: inline-block;
                float: left;
                width: 49%;
                margin-right: 2%;
                overflow: auto;
                text-align: center;
            }
            #quizzie ul li.quiz-answer {
                cursor: pointer;
            }
            #quizzie ul li.question, #quizzie ul li.results-inner {
                display: block;
                float: none;
                width: 100%;
                text-align: center;
                margin: 0;
                margin-bottom: 2%;
            }
            #quizzie ul li.results-inner {
                padding: 5% 2%;
            }
            #quizzie ul li.results-inner img {
                width: 250px;
            }


            #quizzie .question-wrap, #quizzie .answer-wrap {
                display: block;
                padding: 1%;
                margin: 1em 10%;
                -moz-border-radius: 10px;
                -webkit-border-radius: 10px;
                border-radius: 10px;
            }
            #quizzie .answer-wrap {
                -moz-transition: background-color 0.5s ease;
                -o-transition: background-color 0.5s ease;
                -webkit-transition: background-color 0.5s ease;
                transition: background-color 0.5s ease;
            }

            #btn:focus {
                border: 10px solid blue;
            }

            .answer-text {
                background-color: lightgray;
                padding: 10px;
            }
            
        </style>

    </head>

    <body>


        <h1 class="container center">JQUERY FINAL PROJECT</h1>
        <div role="tablist" id="accordion" class="panel-group container">
            <div class="panel panel-default">
                <div id="headingOne" role="tab" class="panel-heading">
                    <h4 class="panel-title">
                        <a aria-controls="collapseOne" aria-expanded="false" href="#collapseOne" data-parent="#accordion" data-toggle="collapse" class="collapsed">
                            GOAL
                        </a>
                    </h4>
                </div>
                <div aria-labelledby="headingOne" role="tabpanel" class="panel-collapse collapse" id="collapseOne" aria-expanded="false" style="height: 0px;">
                    <div class="panel-body">
                        <p>As a user, I want to have fun answering an interactive quiz, and I expect the result to be based on my selections.</p>
                        <p>As a dev, I want to query Flickr JS API for photos based on my quiz topic.</p>
                        <p>As a dev, I want to query Facebook's Graph API for fans based on my quiz topic.</p>
                        <p>As a dev, I want to query Twitter's JS API for keyword search (with relative date) quiz topic.</p>
                    </div>
                </div>
            </div>


            <div class="panel panel-default">
                <div id="headingTwo" role="tab" class="panel-heading">
                    <h4 class="panel-title">
                        <a aria-controls="collapseTwo" aria-expanded="false" href="#collapseTwo" data-parent="#accordion" data-toggle="collapse" class="collapsed">
                            INSPIRATION
                        </a>
                    </h4>
                </div>
                <div aria-labelledby="headingTwo" role="tabpanel" class="panel-collapse collapse" id="collapseTwo" aria-expanded="false">
                    <div class="panel-body">
                        <p>Interactive quizes by <a href="http://www.buzzfeed.com/quizzes">Buzzfeed</a></p>
                    </div>
                </div>
            </div>


            <div class="panel panel-default">
                <div id="headingThree" role="tab" class="panel-heading">
                    <h4 class="panel-title">
                        <a aria-controls="collapseThree" aria-expanded="false" href="#collapseThree" data-parent="#accordion" data-toggle="collapse" class="collapsed">
                            EXPECTATIONS
                        </a>
                    </h4>
                </div>
                <div aria-labelledby="headingThree" role="tabpanel" class="panel-collapse collapse" id="collapseThree" aria-expanded="false">
                    <div class="panel-body">
                        <ul>
                            <li>Build a dynamic quiz with three questions. After the user submits the quiz the result should be reveal on the same page, below the questions. <i>(for 6 points)</i></li>
                            <li>The result is a fun conclusion to the user's answers based on your questions.</li>
                            <li>If the quiz is reloaded and completed a second time with non-repeatitive answers then the result should reflect the questions.</li>
                        </ul>
                    </div>
                </div>
            </div>


            <div class="panel panel-default">
                <div id="headingFour" role="tab" class="panel-heading">
                    <h4 class="panel-title">
                        <a aria-controls="collapseFour" aria-expanded="false" href="#collapseFour" data-parent="#accordion" data-toggle="collapse" class="collapsed">
                            STEPS
                        </a>
                    </h4>
                </div>
                <div aria-labelledby="headingFour" role="tabpanel" class="panel-collapse collapse" id="collapseFour" aria-expanded="false">
                    <div class="panel-body">
                        <ol>
                            <li>Display exactly 4 Flickr photos. Query Flickr by any criterion. <i>(for 4 points)</i></li>
                            <li>Display ~4 profile photos of a Facebook Page based on the photo likes. There are Page fans that like photos, display those user's profile photos. Any Facebook Page is allowed if it has those required fans. <i>(for 4 points)</i></li>
                            <li>Display exactly 4 Twitter tweets (status updates) with relative date (i.e. yesterday, 4 weeks ago). Query Twitter by any criterion. <i>(for 6 points)</i></li>
                        </ol>
                    </div>
                </div>
            </div>


            <div class="panel panel-default">
                <div id="headingFive" role="tab" class="panel-heading">
                    <h4 class="panel-title">
                        <a aria-controls="collapseFive" aria-expanded="false" href="#collapseFive" data-parent="#accordion" data-toggle="collapse" class="collapsed">
                            TECHNOLOGIES
                        </a>
                    </h4>
                </div>
                <div aria-labelledby="headingFive" role="tabpanel" class="panel-collapse collapse" id="collapseFive" aria-expanded="false">
                    <div class="panel-body">
                        <ul>
                            <li><a href="https://www.flickr.com/services/api/">Flickr JS API</a></li>
                            <li><a href="https://developers.facebook.com/docs/graph-api">Facebook Graph API</a></li>
                            <li><a href="https://dev.twitter.com/docs">Twitter JS API</a></li>
                            <li><a href="https://www.npmjs.com/package/twit">Twitter API client for node</a></li>
                            <li>JavaScript</li>
                            <li><a href="http://api.jquery.com/">jQuery</a></li>
                            <li><a href="http://api.jquery.com/jQuery.ajax/">jQuery AJAX</a></li>
                            <li><a href="http://nodejs.org/">node.js</a></li>
                            <li><a href="http://hapijs.com/">hapi.js</a></li>
                        </ul>
                    </div>
                </div>
            </div>


            <div class="panel panel-default">
                <div id="headingSix" role="tab" class="panel-heading">
                    <h4 class="panel-title">
                        <a aria-controls="collapseThree" aria-expanded="false" href="#collapseSix" data-parent="#accordion" data-toggle="collapse" class="collapsed">
                            GRADING
                        </a>
                    </h4>
                </div>
                <div aria-labelledby="headingSix" role="tabpanel" class="panel-collapse collapse" id="collapseSix" aria-expanded="false">
                    <div class="panel-body">
                        <ul>
                            <li>For point breakdown consult the <a href="#Expectations">Expectations</a> section. <i>3 additional points</i> for completing all of the expectations.  For a total of twenty five points for this final project.</li>
                            <li>Deadline is Feb 27th at 23:59 Pacific.  <b>Submission details</b> <i>2 points</i> will be provided for an on-time delivery to <a href="mailto:dan@vanarts.com">dan@vanarts.com</a>.  2 points will be deducted from your total for every late 24-hour day.</li>
                        </ul>
                    </div>
                </div>
            </div>


        </div>
        <BR>















        <div id="quizzie">
            <h1 class="container center">Dubai Obviously</h1>
            <ul class="quiz-step step1 current">
                <li class="question">
                    <div class="question-wrap">
                        <h2>Which place would you visit first?</h2>
                    </div>
                </li>
                <li class="quiz-answer low-value" data-quizIndex="1">
                    <div class="answer-wrap"> 
                        <img src="http://placehold.it/200x200" class="answer-text" id="flickr1" alt="">
                    </div>
                </li>
                <li class="quiz-answer high-value" data-quizIndex="2">
                    <div class="answer-wrap"> 
                        <img src="http://placehold.it/200x200" class="answer-text" id="flickr2" alt="">
                    </div>
                </li>
                <li class="quiz-answer high-value" data-quizIndex="3">
                    <div class="answer-wrap"> 
                        <img src="http://placehold.it/200x200" class="answer-text" id="flickr3" alt="">
                    </div>
                </li>
                <li class="quiz-answer high-value" data-quizIndex="4">
                    <div class="answer-wrap"> 
                        <img src="http://placehold.it/200x200" class="answer-text" id="flickr4" alt="">
                    </div>
                </li>
            </ul>
            
            
            <ul class="quiz-step step2 current">
                <li class="question">
                    <div class="question-wrap">
                        <h2>Who would you take on a trip to Dubai?</h2>
                    </div>
                </li>
                <li class="quiz-answer low-value" data-quizIndex="1">
                    <div class="answer-wrap"> 
                        <img src="http://placehold.it/200x200" class="answer-text" id="fb1" alt="">
                    </div>
                </li>
                <li class="quiz-answer high-value" data-quizIndex="2">
                    <div class="answer-wrap">
                        <img src="http://placehold.it/200x200" class="answer-text" id="fb2" alt="">
                    </div>
                </li>
                <li class="quiz-answer high-value" data-quizIndex="3">
                    <div class="answer-wrap">
                        <img src="http://placehold.it/200x200" class="answer-text" id="fb3" alt="">
                    </div>
                </li>
                <li class="quiz-answer high-value" data-quizIndex="4">
                    <div class="answer-wrap">
                        <img src="http://placehold.it/200x200" class="answer-text" id="fb4" alt="">
                    </div>
                </li>
            </ul>
            
            
            <ul class="quiz-step step3 current">
                <li class="question">
                    <div class="question-wrap">
                        <h2>Pick a tweet, any tweet</h2>
                    </div>
                </li>
                <li class="quiz-answer low-value" data-quizIndex="1">
                    <div class="answer-wrap">
                        <div class="answer-text">
                            <span class="twt1"></span>
                            <Br></br>
                            <span class="date1"></span>
                        </div>
                    </div>
                </li>
                <li class="quiz-answer high-value" data-quizIndex="2">
                    <div class="answer-wrap">
                        <div class="answer-text">
                            <span class="twt2"></span>
                            <Br></br>
                            <span class="date2"></span>
                        </div>
                    </div>
                </li>
                <li class="quiz-answer high-value" data-quizIndex="3">
                    <div class="answer-wrap">
                        <div class="answer-text">
                            <span class="twt3"></span>
                            <Br></br>
                            <span class="date3"></span>
                        </div>
                    </div>
                </li>
                <li class="quiz-answer high-value" data-quizIndex="4">
                    <div class="answer-wrap">
                        <div class="answer-text">
                            <span class="twt4"></span>
                            <Br></br>
                            <span class="date4"></span>
                        </div>
                    </div>
                </li>
            </ul>
            
            <ul id="results" class="current">
                <li class="results-inner">
                    <p>Your result is:</p>
                    <h1></h1>
                    <p class="desc"></p>
                </li>
            </ul>
        </div>

        <!-- jQuery library -->
        <script src="http://code.jquery.com/jquery-2.1.3.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>

        <!-- Flickr API global variables -->
        <script src="shared/credentials.js"></script>
        <script src="shared/flickr.js"></script>


        <script>

//* Flickr *//

            myflickrOptions.data.api_key = credentials.flickr.api_key;
            myflickrOptions.data.user_id = credentials.flickr.user_id;
            $.ajax({
                "url": myflickrOptions.url,
                "data": myflickrOptions.data,
                "success": function (response) {
                    var html = '';
                    photoSrc = createJpgPath(response.photos.photo);
                    for (var i = 0, len = photoSrc.length; i < len; i++) {
                        html = "<img src='" + photoSrc[i] + "'>";
                        var selector = '#flickr' + (i + 1);
                        $(selector).replaceWith(html);
                    }
                }
            });

            ///////////////////////************************///////////////////////////

            //* Facebook *//

            $.ajax({
                url: 'http://graph.facebook.com/abhishek.gyaneshwar/picture',
                success: function (response) {
                    var output = "<img src='http://graph.facebook.com/abhishek.gyaneshwar/picture'>" + "<br></br>";
                    $('#fb1').replaceWith(output);
                }
            });
            $.ajax({
                url: 'http://graph.facebook.com/WataruOguchi/picture',
                success: function (response) {
                    var output = "<img src='http://graph.facebook.com/WataruOguchi/picture'>" + "<br></br>";
                    $('#fb2').replaceWith(output);
                }
            });
            $.ajax({
                url: 'http://graph.facebook.com/melanie.pellegrino.94/picture',
                success: function (response) {
                    var output = "<img src='http://graph.facebook.com/melanie.pellegrino.94/picture'>" + "<br></br>";
                    $('#fb3').replaceWith(output);
                }
            });
            $.ajax({
                url: 'http://graph.facebook.com/troy.strachan/picture',
                success: function (response) {
                    var output = "<img src='http://graph.facebook.com/troy.strachan/picture'>" + "<br></br>";
                    $('#fb4').replaceWith(output);
                }
            });

            ///////////////////////************************///////////////////////////


            //* Twitter *//

            $.ajax({
                url: '/twitter',
                success: function (response) {

                    $('.twt1').append(response[0].tweet);
                    $('.twt2').append(response[1].tweet);
                    $('.twt3').append(response[2].tweet);
                    $('.twt4').append(response[3].tweet);

                    $('.date1').append(response[0].tweetDate);
                    $('.date2').append(response[1].tweetDate);
                    $('.date3').append(response[2].tweetDate);
                    $('.date4').append(response[3].tweetDate);
                }
            });




            //* Quiz Stuff *//


            // Quiz result options in a separate object for flexibility
            var resultOptions = [
                {title: '1',
                    desc: '<p>1</p><img src="http://i.imgur.com/tXTjD9k.jpg"/>'},
                {title: '2',
                    desc: '<p>2</p><img src="http://i.imgur.com/dipkE0v.jpg"/>'},
                {title: '3',
                    desc: '<p>3</p><img src="http://i.imgur.com/WXox0Yv.jpg"/>'},
                {title: '4',
                    desc: '<p>4</p><img src="http://i.imgur.com/NH5cunw.png"/>'},
                {title: '5',
                    desc: '<p>5</p><img src="http://i.imgur.com/NH5cunw.png"/>'}
            ];

            // global variables
            var quizSteps = $('#quizzie .quiz-step'),
                    totalScore = 0;

            // for each step in the quiz, add the selected answer value to the total score
            // if an answer has already been selected, subtract the previous value and update total score with the new selected answer value
            // toggle a visual active state to show which option has been selected
            quizSteps.each(function () {
                var currentStep = $(this),
                        ansOpts = currentStep.children('.quiz-answer');
                // for each option per step, add a click listener
                // apply active class and calculate the total score
                ansOpts.each(function () {
                    var eachOpt = $(this);
                    eachOpt[0].addEventListener('click', check, false);
                    function check() {
                        var $this = $(this),
                                value = $this.attr('data-quizIndex'),
                                answerScore = parseInt(value);
                        // check to see if an answer was previously selected
                        if (currentStep.children('.active').length > 0) {
                            var wasActive = currentStep.children('.active'),
                                    oldScoreValue = wasActive.attr('data-quizIndex'),
                                    oldScore = parseInt(oldScoreValue);
                            // handle visual active state
                            currentStep.children('.active').removeClass('active');
                            $this.addClass('active');
                            // handle the score calculation
                            totalScore -= oldScoreValue;
                            totalScore += answerScore;
                            calcResults(totalScore);
                        } else {
                            // handle visual active state
                            $this.addClass('active');
                            // handle score calculation
                            totalScore += answerScore;
                            calcResults(totalScore);
                            // handle current step
                            updateStep(currentStep);
                        }
                    }
                });
            });


            // display scoring results
            function calcResults(totalScore) {
                // only update the results div if all questions have been answered
                if (quizSteps.find('.active').length == quizSteps.length) {
                    var resultsTitle = $('#results h1'),
                            resultsDesc = $('#results .desc');

                    // calc lowest possible score
                    var lowestScoreArray = $('#quizzie .low-value').map(function () {
                        return $(this).attr('data-quizIndex');
                    });
                    var minScore = 0;
                    for (var i = 0; i < lowestScoreArray.length; i++) {
                        minScore += lowestScoreArray[i] << 0;
                    }
                    // calculate highest possible score
                    var highestScoreArray = $('#quizzie .high-value').map(function () {
                        return $(this).attr('data-quizIndex');
                    });
                    var maxScore = 0;
                    for (var i = 0; i < highestScoreArray.length; i++) {
                        maxScore += highestScoreArray[i] << 0;
                    }
                    // calc range, number of possible results, and intervals between results
                    var range = maxScore - minScore,
                            numResults = resultOptions.length,
                            interval = range / (numResults - 1),
                            increment = '',
                            n = 0; //increment index
                    // incrementally increase the possible score, starting at the minScore, until totalScore falls into range. then match that increment index (number of times it took to get totalScore into range) and return the corresponding index results from resultOptions object
                    while (n < numResults) {
                        increment = minScore + (interval * n);
                        if (totalScore <= increment) {
                            // populate results
                            resultsTitle.replaceWith("<h1>" + resultOptions[n].title + "</h1>");
                            resultsDesc.replaceWith("<p class='desc'>" + resultOptions[n].desc + "</p>");
                            return;
                        } else {
                            n++;
                        }
                    }
                }
            }

        </script>

    </body>

</html>